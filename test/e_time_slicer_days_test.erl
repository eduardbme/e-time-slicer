-module(e_time_slicer_days_test).
-compile(export_all).

-include_lib("eunit/include/eunit.hrl").

-define(test(T), {setup, fun start/0, fun stop/1, T}).

start() -> ok.
stop(_) -> ok.

test({input, Input, expected_result, ExpectedResult}) ->
  fun() ->
    {ok, Result} = erlang:apply(e_time_slicer, slice, Input),

    ?assertEqual(ExpectedResult, Result)
  end.

all_tests_test_() ->
  TestCases = [
%%    {
%%      %% %% Test with a leap year
%%      %% 1577836800 - 01 Jan 2020 00:00:00 GMT
%%      %% 1609891200 - 06 Jan 2021 00:00:00 GMT
%%      input, [1577836800, 1609891200, [{scale, days}]],
%%      expected_result, [
%%        {type, weeks},
%%        {count, 53},
%%        {from, 1577836800},
%%        {to, 1609891200},
%%        {remainder, 0},
%%        {slices, [
%%          [{from,1577836800},{to,1578441600}],
%%          [{from,1578441600},{to,1579046400}],
%%          [{from,1579046400},{to,1579651200}],
%%          [{from,1579651200},{to,1580256000}],
%%          [{from,1580256000},{to,1580860800}],
%%          [{from,1580860800},{to,1581465600}],
%%          [{from,1581465600},{to,1582070400}],
%%          [{from,1582070400},{to,1582675200}],
%%          [{from,1582675200},{to,1583280000}],
%%          [{from,1583280000},{to,1583884800}],
%%          [{from,1583884800},{to,1584489600}],
%%          [{from,1584489600},{to,1585094400}],
%%          [{from,1585094400},{to,1585699200}],
%%          [{from,1585699200},{to,1586304000}],
%%          [{from,1586304000},{to,1586908800}],
%%          [{from,1586908800},{to,1587513600}],
%%          [{from,1587513600},{to,1588118400}],
%%          [{from,1588118400},{to,1588723200}],
%%          [{from,1588723200},{to,1589328000}],
%%          [{from,1589328000},{to,1589932800}],
%%          [{from,1589932800},{to,1590537600}],
%%          [{from,1590537600},{to,1591142400}],
%%          [{from,1591142400},{to,1591747200}],
%%          [{from,1591747200},{to,1592352000}],
%%          [{from,1592352000},{to,1592956800}],
%%          [{from,1592956800},{to,1593561600}],
%%          [{from,1593561600},{to,1594166400}],
%%          [{from,1594166400},{to,1594771200}],
%%          [{from,1594771200},{to,1595376000}],
%%          [{from,1595376000},{to,1595980800}],
%%          [{from,1595980800},{to,1596585600}],
%%          [{from,1596585600},{to,1597190400}],
%%          [{from,1597190400},{to,1597795200}],
%%          [{from,1597795200},{to,1598400000}],
%%          [{from,1598400000},{to,1599004800}],
%%          [{from,1599004800},{to,1599609600}],
%%          [{from,1599609600},{to,1600214400}],
%%          [{from,1600214400},{to,1600819200}],
%%          [{from,1600819200},{to,1601424000}],
%%          [{from,1601424000},{to,1602028800}],
%%          [{from,1602028800},{to,1602633600}],
%%          [{from,1602633600},{to,1603238400}],
%%          [{from,1603238400},{to,1603843200}],
%%          [{from,1603843200},{to,1604448000}],
%%          [{from,1604448000},{to,1605052800}],
%%          [{from,1605052800},{to,1605657600}],
%%          [{from,1605657600},{to,1606262400}],
%%          [{from,1606262400},{to,1606867200}],
%%          [{from,1606867200},{to,1607472000}],
%%          [{from,1607472000},{to,1608076800}],
%%          [{from,1608076800},{to,1608681600}],
%%          [{from,1608681600},{to,1609286400}],
%%          [{from,1609286400},{to,1609891200}]
%%        ]}
%%      ]
%%    },
%%    {
%%      %% 1546300800 - 01 Jan 2019 00:00:00 GMT
%%      %% 1577836800 - 01 Jan 2020 00:00:00 GMT
%%      input, [1546300800, 1577836800, [{scale, weeks}]],
%%      expected_result, [
%%        {type, weeks},
%%        {count, 52},
%%        {from, 1546300800},
%%        {to, 1577836800 - 86400},
%%        {remainder, 86400},
%%        {slices,[[{from,1546300800},{to,1546905600}],
%%          [{from,1546905600},{to,1547510400}],
%%          [{from,1547510400},{to,1548115200}],
%%          [{from,1548115200},{to,1548720000}],
%%          [{from,1548720000},{to,1549324800}],
%%          [{from,1549324800},{to,1549929600}],
%%          [{from,1549929600},{to,1550534400}],
%%          [{from,1550534400},{to,1551139200}],
%%          [{from,1551139200},{to,1551744000}],
%%          [{from,1551744000},{to,1552348800}],
%%          [{from,1552348800},{to,1552953600}],
%%          [{from,1552953600},{to,1553558400}],
%%          [{from,1553558400},{to,1554163200}],
%%          [{from,1554163200},{to,1554768000}],
%%          [{from,1554768000},{to,1555372800}],
%%          [{from,1555372800},{to,1555977600}],
%%          [{from,1555977600},{to,1556582400}],
%%          [{from,1556582400},{to,1557187200}],
%%          [{from,1557187200},{to,1557792000}],
%%          [{from,1557792000},{to,1558396800}],
%%          [{from,1558396800},{to,1559001600}],
%%          [{from,1559001600},{to,1559606400}],
%%          [{from,1559606400},{to,1560211200}],
%%          [{from,1560211200},{to,1560816000}],
%%          [{from,1560816000},{to,1561420800}],
%%          [{from,1561420800},{to,1562025600}],
%%          [{from,1562025600},{to,1562630400}],
%%          [{from,1562630400},{to,1563235200}],
%%          [{from,1563235200},{to,1563840000}],
%%          [{from,1563840000},{to,1564444800}],
%%          [{from,1564444800},{to,1565049600}],
%%          [{from,1565049600},{to,1565654400}],
%%          [{from,1565654400},{to,1566259200}],
%%          [{from,1566259200},{to,1566864000}],
%%          [{from,1566864000},{to,1567468800}],
%%          [{from,1567468800},{to,1568073600}],
%%          [{from,1568073600},{to,1568678400}],
%%          [{from,1568678400},{to,1569283200}],
%%          [{from,1569283200},{to,1569888000}],
%%          [{from,1569888000},{to,1570492800}],
%%          [{from,1570492800},{to,1571097600}],
%%          [{from,1571097600},{to,1571702400}],
%%          [{from,1571702400},{to,1572307200}],
%%          [{from,1572307200},{to,1572912000}],
%%          [{from,1572912000},{to,1573516800}],
%%          [{from,1573516800},{to,1574121600}],
%%          [{from, 1574121600}, {to, 1574726400}],
%%          [{from, 1574726400}, {to, 1575331200}],
%%          [{from, 1575331200}, {to, 1575936000}],
%%          [{from, 1575936000}, {to, 1576540800}],
%%          [{from ,1576540800}, {to, 1577145600}],
%%          [{from, 1577145600}, {to, 1577750400}]
%%        ]}
%%      ]
%%    },
    {
      %% 1577836800 - 01 Jan 2020 00:00:00 GMT
      %% 1578268800 - 01 Jan 2020 00:00:01 GMT
      input, [1577836800, 1577836801, [{scale, days}]],
      expected_result, [
        {type, days},
        {count, 0},
        {from, 1577836800},
        {to, undefined},
        {remainder, 1},
        {slices, []}
      ]
    },
    {
      %% 1577836800 - 01 Jan 2020 00:00:00 GMT
      %% 1578268800 - 06 Jan 2020 00:00:00 GMT
      input, [1577836800, 1578268800, [{scale, days}]],
      expected_result, [
        {type, days},
        {count, 5},
        {from, 1577836800},
        {to, 1578268800},
        {remainder, 0},
        {slices, [
          [{from, 1577836800}, {to, 1577836800 + 86400}],
          [{from, 1577836800 + 86400}, {to, 1577836800 + 86400 + 86400}],
          [{from, 1577836800 + 86400 + 86400}, {to, 1577836800 + 86400 + 86400 + 86400}],
          [{from, 1577836800 + 86400 + 86400 + 86400}, {to, 1577836800 + 86400 + 86400 + 86400 + 86400}],
          [{from, 1577836800 + 86400 + 86400 + 86400 + 86400}, {to, 1577836800 + 86400 + 86400 + 86400 + 86400 + 86400}]
        ]}
      ]
    },
    {
      %% 1577836800 - 01 Jan 2020 00:00:00 GMT
      %% 1578268801 - 06 Jan 2020 00:00:01 GMT
      input, [1577836800, 1578268801, [{scale, days}]],
      expected_result, [
        {type, days},
        {count, 5},
        {from, 1577836800},
        {to, 1578268800},
        {remainder, 1},
        {slices, [
          [{from, 1577836800}, {to, 1577836800 + 86400}],
          [{from, 1577836800 + 86400}, {to, 1577836800 + 86400 + 86400}],
          [{from, 1577836800 + 86400 + 86400}, {to, 1577836800 + 86400 + 86400 + 86400}],
          [{from, 1577836800 + 86400 + 86400 + 86400}, {to, 1577836800 + 86400 + 86400 + 86400 + 86400}],
          [{from, 1577836800 + 86400 + 86400 + 86400 + 86400}, {to, 1577836800 + 86400 + 86400 + 86400 + 86400 + 86400}]
        ]}
      ]
    },
    {
      %% 1577836800 - 01 Jan 2020 00:00:00 GMT
      %% 1578268861 - 06 Jan 2020 00:01:01 GMT
      input, [1577836800, 1578268861, [{scale, days}]],
      expected_result, [
        {type, days},
        {count, 5},
        {from, 1577836800},
        {to, 1578268800},
        {remainder, 61},
        {slices, [
          [{from, 1577836800}, {to, 1577836800 + 86400}],
          [{from, 1577836800 + 86400}, {to, 1577836800 + 86400 + 86400}],
          [{from, 1577836800 + 86400 + 86400}, {to, 1577836800 + 86400 + 86400 + 86400}],
          [{from, 1577836800 + 86400 + 86400 + 86400}, {to, 1577836800 + 86400 + 86400 + 86400 + 86400}],
          [{from, 1577836800 + 86400 + 86400 + 86400 + 86400}, {to, 1577836800 + 86400 + 86400 + 86400 + 86400 + 86400}]
        ]}
      ]
    },
    {
      %% 1577836800 - 01 Jan 2020 00:00:00 GMT
      %% 1578272461 - 06 Jan 2020 01:01:01 GMT
      input, [1577836800, 1578272461, [{scale, days}]],
      expected_result, [
      {type, days},
      {count, 5},
      {from, 1577836800},
      {to, 1578268800},
      {remainder, 3661},
      {slices, [
        [{from, 1577836800}, {to, 1577836800 + 86400}],
        [{from, 1577836800 + 86400}, {to, 1577836800 + 86400 + 86400}],
        [{from, 1577836800 + 86400 + 86400}, {to, 1577836800 + 86400 + 86400 + 86400}],
        [{from, 1577836800 + 86400 + 86400 + 86400}, {to, 1577836800 + 86400 + 86400 + 86400 + 86400}],
        [{from, 1577836800 + 86400 + 86400 + 86400 + 86400}, {to, 1577836800 + 86400 + 86400 + 86400 + 86400 + 86400}]
      ]}
    ]
    }
  ],

  [
    ?test(fun(_) -> {timeout, 1000, test(TestCase)} end) ||
    TestCase <- TestCases
  ].
